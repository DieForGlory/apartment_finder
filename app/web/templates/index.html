{% extends "base.html" %}

{% block content %}
    <h1 class="mb-4">Каталог объектов недвижимости</h1>

    {% if sells_pagination and sells_pagination.items %}
    <div class="table-responsive">
        <table class="table table-striped table-hover">
           <thead class="thead-dark">
                <tr>
                    <th>ID объекта</th>
                    <th>Тип объекта</th>
                    <th>Название проекта</th>
                    <th>Этаж</th>
                    <th>Номер дома</th> <th>Кол-во комнат</th>
                    <th>Цена за м² (прайс)</th>
                </tr>
            </thead>
            <tbody>
                {% for sell in sells_pagination.items %}
                <tr>
                    <td>{{ sell.id }}</td>
                    <td>{{ sell.estate_sell_category or '—' }}</td>
                    <td>{{ sell.house.complex_name or '—' }}</td>
                    <td>{{ sell.estate_floor or '—' }}</td>
                    {# Вот правильный способ доступа к данным дома через объект продажи #}
                    <td>{{ sell.house.geo_house or '—' }}</td>
                    <td>{{ sell.estate_rooms or '—' }}</td>
                    <td>{{ "%.2f"|format(sell.estate_price_m2) if sell.estate_price_m2 else '—' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {# НАВИГАЦИЯ ПО СТРАНИЦАМ (ПАГИНАЦИЯ) #}
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {# Ссылка "Назад" #}
            <li class="page-item {% if not sells_pagination.has_prev %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('main.index', page=sells_pagination.prev_num) }}">Назад</a>
            </li>

            {# Номера страниц #}
            {% for page_num in sells_pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                {% if page_num %}
                    <li class="page-item {% if page_num == sells_pagination.page %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('main.index', page=page_num) }}">{{ page_num }}</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">…</span></li>
                {% endif %}
            {% endfor %}

            {# Ссылка "Вперед" #}
            <li class="page-item {% if not sells_pagination.has_next %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('main.index', page=sells_pagination.next_num) }}">Вперед</a>
            </li>
        </ul>
    </nav>
    <div class="text-center text-muted">
        <small>Показаны записи с {{ sells_pagination.first }} по {{ sells_pagination.last }} из {{ sells_pagination.total }}</small>
    </div>

    {% else %}
    <div class="alert alert-warning">
        Данные не загружены или объекты отсутствуют.
    </div>
    {% endif %}
{% endblock %}